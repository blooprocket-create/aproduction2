<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Login â€” Novus Academy</title><link rel="stylesheet" href="styles.css"/></head>
<body><div class="blob"></div><div class="blob b2"></div><div class="blob b3"></div>
<header class="header"><div class="container nav">
  <a class="brand" href="index.html"><div class="logo"></div><span>Novus Academy</span></a>
  <nav class="flex">
        <a href="catalog.html">Courses</a>
        <a id="accountLink" href="account.html" style="display:none">Account</a>
        <a id="loginLink" href="login.html">Login</a>
        <a href="admin.html" class="btn secondary" data-role="admin-link">Control Panel</a>
      </nav>
</div></header>
<main class="container section">
  <h1>Welcome back</h1><p class="sub">Log in to access your courses.</p>
  <div class="card"><div class="row">
    <input id="email" class="input" placeholder="you@domain.com"/>
    <input id="password" type="password" class="input" placeholder="Password"/>
  </div><div class="flex" style="margin-top:12px"><button id="loginBtn" class="btn">Log In</button></div></div>
  <small id="bootstrapLink" style="color:var(--muted);display:none">No admin yet? <a href="bootstrap.html">Create the first admin</a>.</small>
</main>
<script src="auth.js"></script>
<script>
  const next=new URLSearchParams(location.search).get("next")||"account.html";
  document.getElementById("loginBtn").addEventListener("click", async ()=>{
    const email=document.getElementById("email").value.trim();
    const pw=document.getElementById("password").value;
    try{ await loginUser({email,password:pw}); location.href=next; }catch(e){ alert(e.message||"Login failed"); }
  });
  if(!hasValidAdmin()) document.getElementById("bootstrapLink").style.display="block";
</script>
<script src="auth.js"></script>
<script>
  // Hide admin/control-panel links unless role is admin/editor
  (function(){
    try {
      const s = JSON.parse(localStorage.getItem('novus:session')||'null');
      const db = JSON.parse(localStorage.getItem('novus:db')||'null');
      const user = s && db ? (db.users||[]).find(u=>u.id===s.userId) : null;
      const role = user?.role || null;
      // Hide any element with data-role="admin-link" if not admin/editor
      document.querySelectorAll('[data-role="admin-link"]').forEach(el=>{
        if(!(role==="admin" || role==="editor")) el.style.display="none";
      });
    } catch(_) {}
  })();
</script>

<script src="auth.js"></script>
<script>
  (function(){
    try{
      const s = JSON.parse(localStorage.getItem('novus:session')||'null');
      const db = JSON.parse(localStorage.getItem('novus:db')||'null');
      const user = s && db ? (db.users||[]).find(u=>u.id===s.userId) : null;
      const role = user?.role || null;
      // Hide any admin-only links
      document.querySelectorAll('[data-role="admin-link"]').forEach(el=>{
        if(!(role==="admin" || role==="editor")) el.style.display="none";
      });
      // Login/Logout/Account controls
      const loginLink = document.getElementById('loginLink');
      const accountLink = document.getElementById('accountLink');
      if(user){
        if(accountLink) accountLink.style.display = '';
        if(loginLink){
          loginLink.textContent = `Logout (${user.name||'Account'})`;
          loginLink.href = '#';
          loginLink.addEventListener('click', (e)=>{
            e.preventDefault();
            logoutUser();
            // Keep on the same page but refresh UI
            location.reload();
          }, { once: true });
        }
      } else {
        if(accountLink) accountLink.style.display = 'none';
        if(loginLink){
          loginLink.textContent = 'Login';
          loginLink.href = 'login.html';
        }
      }
    }catch(_){}
  })();
</script>


<script src="auth.js"></script>
<script>
  // nav-init-singleton
  (function(){
    if (window.__navInitOnce) return; window.__navInitOnce = true;
    try{
      const s = JSON.parse(localStorage.getItem('novus:session')||'null');
      const db = JSON.parse(localStorage.getItem('novus:db')||'null');
      const user = s && db ? (db.users||[]).find(u=>u.id===s.userId) : null;
      const role = user?.role || null;
      // Hide admin-only links
      document.querySelectorAll('[data-role="admin-link"]').forEach(el=>{
        if(!(role==="admin" || role==="editor")) el.style.display="none";
      });
      // Login/Logout/Account controls
      const loginLink = document.getElementById('loginLink');
      const accountLink = document.getElementById('accountLink');
      if(user){
        if(accountLink) accountLink.style.display = '';
        if(loginLink){
          loginLink.textContent = `Logout (${user.name||'Account'})`;
          loginLink.href = '#';
          loginLink.addEventListener('click', (e)=>{
            e.preventDefault();
            logoutUser();
            location.reload();
          }, { once: true });
        }
      } else {
        if(accountLink) accountLink.style.display = 'none';
        if(loginLink){
          loginLink.textContent = 'Login';
          loginLink.href = 'login.html';
        }
      }
    }catch(_){}
  })();
</script>


<script src="auth.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  try{
    const s = JSON.parse(localStorage.getItem('novus:session')||'null');
    const db = JSON.parse(localStorage.getItem('novus:db')||'null');
    const user = s && db ? (db.users||[]).find(u=>u.id===s.userId) : null;
    const role = user?.role || null;
    // Admin-only visibility
    document.querySelectorAll('[data-role="admin-link"]').forEach(el=>{
      if(!(role==='admin' || role==='editor')) el.style.display='none';
    });
    const loginLink = document.getElementById('loginLink');
    const accountLink = document.getElementById('accountLink');
    if(user){
      if(accountLink) accountLink.style.display='';
      if(loginLink){
        loginLink.textContent = `Logout (${user.name||'Account'})`;
        loginLink.href = '#';
        loginLink.onclick = (e) => { e.preventDefault(); logoutUser(); location.reload(); };
      }
    } else {
      if(accountLink) accountLink.style.display='none';
      if(loginLink){ loginLink.textContent='Login'; loginLink.href='login.html'; loginLink.onclick=null; }
    }
  }catch(e){ console.warn('nav init error', e); }
});
</script>

</body></html>
