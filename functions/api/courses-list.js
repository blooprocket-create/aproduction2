const {pool}=require('./util/db'); const {json}=require('./util/http'); exports.handler=async(e)=>{ const onlyPub=e.queryStringParameters?.published!=='false'; const c=await pool.connect(); try{ const r=await c.query(`SELECT id,title,slug,description,hours,level,price,image,published,sales FROM courses ${onlyPub?'WHERE published=true':''} ORDER BY sales DESC NULLS LAST, title ASC LIMIT 200`); return json(200,{courses:r.rows}); } finally{ c.release(); } };