const {pool}=require('./util/db');const {json,readJSON}=require('./util/http');exports.handler=async(e)=>{if(e.httpMethod==='POST'){const {email}=await readJSON(e);if(!email) return json(400,{error:'Email required'});const c=await pool.connect();try{await c.query('INSERT INTO emails (email) VALUES ($1) ON CONFLICT (email) DO NOTHING',[email]);return json(200,{ok:true})}finally{c.release()}}if(e.httpMethod==='GET'){const c=await pool.connect();try{const r=await c.query('SELECT email, created_at FROM emails ORDER BY created_at DESC LIMIT 500');return json(200,{emails:r.rows})}finally{c.release()}}return json(405,{error:'Method Not Allowed'})};